<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Captcha Solver</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css">
    <style>
        /* Add custom CSS styles here */
    </style>
</head>

<body>
    <div class="container">
        <h1>Captcha Solver</h1>
        <div id="captchaImage"></div>
        <p><strong>Solved Captcha:</strong> <span id="captchaText"></span></p>
        <p><strong>Solved Captchas Counter:</strong> <span id="solvedCounter">0</span></p>
        <p><strong>Total Sum:</strong> <span id="totalSum"></span></p>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/marked@3.0.0/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.3.1/build/highlight.min.js"></script>
    <script>
        // Add your JavaScript code here
        let solvedCaptchaCounter = 0;

        function updateSolvedCounter() {
            document.getElementById('solvedCounter').textContent = ++solvedCaptchaCounter;
        }

        function solveCaptcha(imageUrl) {
            fetch(imageUrl)
                .then(response => response.blob())
                .then(blob => {
                    const url = URL.createObjectURL(blob);
                    document.getElementById('captchaImage').innerHTML = `<img src="${url}" alt="Captcha Image">`;
                    const startTime = performance.now();
                    fetch('sample.txt') // Assume the solved captcha text is in sample.txt
                        .then(response => response.text())
                        .then(data => {
                            const endTime = performance.now();
                            const elapsedTime = (endTime - startTime) / 1000;
                            document.getElementById('captchaText').innerText = data;
                            updateSolvedCounter();
                            console.log(`Solved in ${elapsedTime} seconds`);

                            // Parsing CSV data
                            const sum = processData(data);
                            if (sum !== null) {
                                document.getElementById('totalSum').innerText = sum;
                            } else {
                                console.error('Error processing CSV data');
                            }
                        })
                        .catch(error => console.error(error));
                })
                .catch(error => console.error(error));
        }

        function processData(data) {
            const lines = data.trim().split('\n');
            let totalSum = 0;

            for (let line of lines) {
                const values = line.split(',');
                let lineSum = 0;

                for (let val of values) {
                    const parsedVal = parseFloat(val.trim());
                    if (!isNaN(parsedVal)) {
                        lineSum += parsedVal;
                    } else {
                        console.error('Invalid number found:', val);
                        return null;
                    }
                }

                totalSum += lineSum;
            }

            return totalSum;
        }

        const urlParams = new URLSearchParams(window.location.search);
        const imageUrlParam = urlParams.get('url');
        if (imageUrlParam) {
            solveCaptcha(imageUrlParam);
        } else {
            solveCaptcha('sample.png');
        }
    </script>
</body>

</html>